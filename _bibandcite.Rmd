---
title: "Bibiliographies and Citations"
author: "Justin Lawrence Kroes"
date: "June 27, 2016"
bibliography: BibAndCite.bib
link-citations: true
output:
  html_document:
    toc: yes
    code_folding: show
nocite: |
  @lierdakil_pandoc_2016
  @macfarlane_pandoc_
  @emilianoeheyns_bibtex_2016
  @retorquere_zotero_2016
  @macfarlane_pandoc_a
  @jgm_pandoc_2016
  @_summary_2007
  @ebo_bibtex_2011
  @_bibliographies_
  @best_rmarkdown_2015
  @mclean_straightforward_2014
  @mclean_user_
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

[pandoc-citeproc]: <https://github.com/jgm/pandoc-citeproc>
[Zotero Better Bibtex]: <https://github.com/retorquere/zotero-better-bibtex/wiki/Installation>
[`pandoc-crossref`]: <https://github.com/lierdakil/pandoc-crossref>

# Introduction

R Markdown uses Pandoc to generate bibliographies and citations. There are several top-level YAML-header options relevant to this process:

* `bibliography`
* `references`
* `csl`
* `nocite`

The following tabs deal with usage of these options in a .Rmd file.

# YAML-Header Options {.tabset}

## `bibliography`

The value of the `bibliography` key should be a filename **in the same directory as .Rmd**. This file may have one of several different extensions [see @_bibliographies_]. The extension I prefer is .bib. 

```{r bib_field, eval = FALSE}
---
title: "Sample Document"
output: html_document
bibliography: bibliography.bib
---
```

Bibliographies are automatically placed at the end of the document for applicable CSL styles, so it is useful to end your document with an appropriate header:

```{r bib_header, eval = FALSE}
last paragraph...

# References
```

Note that the bibliography section ("References", on my end) is automatically unnumbered. 

Finally, if you want to generate a human-readable bibliography against which to check your Rmd one, from Zotero try "Create Bibliography from Collection".

### About .bib files

**Disclaimer**: the following is my own incomplete understanding of citation software and digital typesetting based on the explanation of very few sources.

`.bib` is a bibliographic information (or "database") file similar to the `.sql` or `.sqlite` files used to store bibliographic information by Zotero. Often these files are fed into programs such as `biber` or `BibTeX`, in order to generate bibliographies within files using `TeX` typesetting/markup. Packages such as `biblatex` and `natbib` provide extra functionality by providing macros to cite sources within the `Tex` document, etc.

### .bib file structure

There are a number of ways to structure bibliographic entries in a .bib file. @decoret_summary_2007 provides a thorough overview if you're interested in manually manipulating the contents of a .bib file, rather than adjusting items' fields in citation software or working with CSL.

## `references`

An alternative to using an external database file is to use the `references` key in the YAML header. Its "value" is a series of key-value pairs as seen in @macfarlane_pandoc_.

Rather than manually typing up a reference for each source, it is possible to use a library/executable to automatically convert .bib files to YAML-style references, which can then be inserted into your .Rmd file via [pandoc-citeproc][]

## `csl`

Pandoc's default citation style is Chicago author-date format. Alternative styles can be designated by setting the `csl` option's value as a .csl file:

```{r citation_style, eval = FALSE}
---
title: "Sample Document"
output: html_document
bibliography: bibliography.bib
csl: biomed-central.csl
---
```

The R Markdown site contains links to two CSL repositories, as well as a "primer on creating and modifying CSL styles" [see @_bibliographies_a].

## `nocite`

*Unless you use citations your references will normally not be appended to the end of the output document generated by Pandoc*. The exception occurs via the `cite` option. 

The values that this option takes are citation keys. In this example, `item1` and `item2` have not been cited.

```{r nocite, eval = FALSE}
---
nocite: | 
  @item1, @item2
---
```

# Citations {.tabset}

## Base R Markdown

Citations are carried out through *citation keys*. Citation keys consist of `@` and a citation identifier. A semicolon should separate multiple citations. For example:

```{r citations, eval = FALSE}
Blah blah [see @doe99, pp. 33-35; also @smith04, ch. 1].
Blah blah [@smith04; @doe99].
```

Brackets can be omitted for partially non-parenthetical citations. A minus sign (`-`) before the `@` will suppres the author's name. 

Citations are rendered according to the value of the `csl` YAML option, which by default is `Chicago author-date`. To render the years portion of citations as hyperlinks to bibliographic entries, add the following to your header:

```{r cite_link, eval = FALSE}
---
link-citations: true
---
```

Note that this functionality is less than ideal. For one, the link consists only of the source's displayed year. Second, the source that you jump to is not indicated. Third and most important, parentheses are always applied to everything except the author. If no author exists, then you can't use a natural in-line citation. As a final note, what if an external link is a file rather than a URL? `RefMangeR` deals with the majority of these issues. 

Allegedly the `pandoc-citeproc` library is used by default to process citations [@macfarlane_pandoc_; @_readme_], and other libraries (e.g. `biblatex`) should be used if generating PDF documents [@_bibliographies_b]

## RefManageR {.tabset}

### Intro to `RefManageR`

`RefManageR` is a package meant to ease the process of generating bibliographies and citations within R. It is compatible with Markdown but primarily meant for working with citations outside of Markdown. While the package options provide more on-the-fly flexibility than `R Markdown`, citations are generated using information in a `.bib` file. Thus, the question is whether your prefer added flexibility and references to `.bib` files over simple references to citation keys generated by Zotero. The following are the basic steps to using `RefManageR`:

(@) Load the bibliography file and set package options (`?BibOptions`) in a chunk with a preceding `{r setup, include = FALSE}`. In `BibOptions()`, specify `style = "markdown"`:

```{r manage_r, eval = FALSE}
library(RefManageR)
bib <- ReadBib("biblatexExamples.bib",
               check = FALSE
               )
BibOptions(check.entries = FALSE,
           style = "markdown",
           bib.style = "alphabetic",
           cite.style = 'numeric',
           max.names = 2,
           first.inits = TRUE
           )
```

The package has a number of options, including `dashed` to control the use of dashes for duplicate authors as in the above example, `max.names` to control the number of names in name list fields that will be printed before they are truncated with “et al.”, and `first.inits` to control whether given names are truncated to first initials or full names are used. All options can be set using `BibOptions()` or passed as options to the `.opts` argument of `PrintBibliography()` or individual cite functions. There is also a package option, `no.print.fields`, for supressing the printing of certain fields. A number of other options are detailed in the "Details" section of `BibOptions()`.

(@) Set citations
(@) Print the bibliography with options echo = FALSE and results = "asis"

```{r print, results = "asis", eval = FALSE}
PrintBibliography(bib, .opts = list(check.entries = FALSE))
```

Note that the option to check for missing entries is set to false in three separate locations. This is probably unnecessary.

Also note that we change around the `cite.style` and `bib.styl` arguments to show the different styles, but one would normally set these at the start of the document and usually keep them set to be equal so that the labels in the citations and bibliography match.

### Citation Functions

From `?Cite`:

"The Cite functions allow for citing a BibEntry object in text. The PrintBibliography function allows for printing the bibliography of all the cited entries. The NoCite function adds references to the bibliography without including a citation. These functions are most useful when used in, e.g., a RMarkdown or RHTML document."

`before` and `after` arguments for text inclusion can be specified to the following functions: 

* `Cite()`
* `Citep()`
* `Autocite()`
* `Citet()`
* `TextCite()`

`Cite` allows specification of either textual or parenthetical citations. `Citet` and `TextCite` allow for textual citations. `Citep` and `Autocite` allow for parenthetical citations. For the purposes of R Markdown, the duplicate commands are redundant and not unique. They stem from the `biblatex` and `natbib` packages (Note: not `R` packages). 

The `...` argument seen in `?Cite` (after loading `RefManageR`) is a placeholder for search terms that you feed the citation functions. Indices and search terms can be specified in a number of ways. Similar to the default extraction operator for list objects, a vector of numeric indices or logical values can be given. Additionally, a character vector of ‘key’ values can be specified. To search by field, a query can be specified with comma delimited field=search.term pairs, with search.term potentially being a vector with length greater than one to match multiple terms for field (think “OR”). Each field = search.term pair will have to match to declare a match for that entry (think “AND”). Multiple queries (“OR”) can be handled (involving different fields) by enclosing each separate query preferably in a list or alternatively, c. For example, list(field11 = search.term11, field12 = search.term12), list(field21 = search.term21). If c is used instead of list, then the search terms must have length one. An ‘!’ at the beginning of a search term can be used to negate a match (obviously, this can also be done using regular expressions).

```{r cite_funs, eval = FALSE}
`r Citet(bib, bibtype = "Report", .opts = list(hyperlink = "to.doc", super = TRUE))` # searches through the character strings following `@` in .bib for "Report"
`r AutoCite(bib, "markey")` # searches for the citation key "markey"
`r AutoCite(bib, "baez/online", before = "e.g., ")` # searches for the citation key "baez/online"
`r NoCite(bib = bib, title = "CTAN")` # searches "title" fields for "CTAN"
```

**Test this**: "If the `...` argument to `NoCite` is identical to “*”, then all references in bib are added to the bibliography without citations."

### Links

If the `hyperlink` option is set to `to.bib`, then hyperlinks will be generated connecting the citation and bibliography. The default value, `to.doc`, will try to create the hyperlink using the url, doi, or eprint fields of entry in a bibliographic entry. Note that the ability to open from file appears to be unavailable for published files (see `open.BibEntry`). If these fields are not available, the hyperlink will point to the bibliography. This behavior can be disabled on an individual basis using the various cite functions (i.e. `Cite`, `Citep`, `AutoCite`, `Citet`, `TextCite`, and `NoCite`, as well as `PrintBibliography`), via the argument `.opts = list(hyperlink = FALSE)`. 

### `bib.style`

A number of bibliography styles (`bib.style`) are available in RefManageR for formatting and displaying citations. The styles currently implemented are `numeric` (the default), `authortitle`, `authoryear`, `alphabetic`, and `draft`. The `authoryear` style always begins with the family name of the first author and follows the list of authors with the year of publication in parentheses. The other four styles all use the same format, differing only in the label they print before each entry. Style `numeric` prints the numeric index of each entry in the bibliography, style `authortitle` uses no label, style `alphabetic` creates a label using the family names of the authors and the last two digits of the publication year, and style `draft` uses the entry key as the label.

### `cite.style`

Using the option `cite.style`, one can specify the apperance of citations: `alphabetic`, `numeric`, or `authoryear`. Additionally, alongside the `numeric` style, one may specify the option `super` to include numeric citations as superscripts. The punctuation to use for enclosing the citations, separating multiple citations, etc. can be set using the `bibpunct` option. A function `NoCite` is provided to include a reference in the bibliography without citing it. 

# Footnotes

Defer to the original source [@macfarlane_pandoc_a].

# Integration with Zotero

1. Install [Zotero Better Bibtex][]. 
2. In Zotero Preferences, set:
    a) Export > Default Output Format > `Better BibTeX Quick Copy`. (Note that `Pandoc Citation`, mentioned elsewhere on the Interwebz, has been merged into this translator.)
    b) Better BibTeX > Quick copy/drag-and-drop citations > QuickCopy format > `Pandoc`. (This controls the actual output from `Better BibTeX Quick Copy`.)
    c) Better BibTex > Citation key format > `[auth:lower]_[veryshorttitle:lower]_[year]` (Or any style you like, I suppose.)
3. Place all references for a given paper into a single (sub)collection. All of my files generated using R Markdown have a bibliography file, which must be in the same directory as the output file. I'm exporting as HTML and Git Markdown variant, and using a repository for each output directory. 
4. Export references to a .bib file.
5. Set .bib filename as the value of the `bibliography` option in the YAML header. 
6. Drag and drop items from Zotero to your input document to generate citations keys for your sources. 

# Further Reading

See [`pandoc-crossref`][] for "numbering figures, equations, tables, and cross-references to them."

# References